Шина данных на базе Apache Kafka, состоящая из отдельных компонентов-микросервисов

![Снимок экрана 2024-09-04 в 22 52 16](https://github.com/user-attachments/assets/c63d332f-a419-41e3-81b0-aaee2ecb9515)

# Описание

Данные поступают во входной топик Kafka, обработанные данные считываются из выходного топика Kafka
Данные обрабатываются 3-мя сервисами: фильтрация (Filtering), дедубликация (Deduplication), обогащение (Enrichment)
Правила для сервисов поступают из соответствующих таблиц базы данных PostgreSQL, правила вычитываются раз в заданный интервал (конфигурация: updateIntervalSec)
Правила конфигурируются с помощью сервиса-менеджера (Management) через Swagger UI (либо же через эндпоинты напрямую)
Сервис дедубликации использует Redis для хранения состояния дублей
Сервис обогащения использует MongoDB для хранения обогащающих данных

# Сервисы
## Фильтрации
Фильтрует данные по заданным правилам
Rules:
- filter_id: id фильтра
- rule_id: id правила
- field_name: json-поле сообщения, по которому выполняется фильтрация
- filter_function_name: название функции фильтрации (equals, contains, not_equals, not_contains)
- filter_value: значение для сравнения

## Дедубликации
Очищает данные от дубликатов, используя для хранения ключей дедубликации Redis (несколько правил фильтрации объединяются в один ключ дедубликации)
Rules:
- deduplication_id: id сервиса дедубликации
- rule_id: id правила
- field_name: json-поле сообщения, по которому выполняется дедубликация
- time_to_live_sec: время жизни ключа в Redis
- is_active: вкл/выкл правила

## Обогащения
Обогащает данные дополнительной информацией, использует для обогащения документы из MongoDB. Несколько правил обогащения объединяются и применяются для одного сообщения. Если два правила обогащают одно и то же поле разными документами, то актуальным правилом является то правило, чей rule_id больше. Если одному правилу соответствует несколько документов, то актуальным является тот документ, чей _id больше (максимальный из всех). Если по актуальному правилу документа в MongoDB нет, то поле обогащается значением по умолчанию из правила. Если правил нет, сообщение не обогащается и отправляется в том виде, в котором есть в выходной топик.
Rules:
- enricher_id: id обогатителя
- rule_id: id правила
- field_name: json-поле сообщения, которое нужно обогатить
- field_name_enrichment: название поля в коллекции MongoDB для обогащения
- field_value: поле сообщения, из которого берется значение поля field_name_enrichment, по которому нужно найти документ в коллекции MongoDB
- field_default_value: значение по умолчанию, если значение для обогащения не найдено в MongoDB

## Management
Позволяет конфигурировать правила фильтрации, дедубликации, обогащения. Валидирует вводимые правила. Имеет несколько метрик.
Endpoints:
**/filter:**
- /findAll: получить информацию о всех фильтрах в БД
- /findAll/{id}: получить информацию о всех фильтрах в БД по filter_id
- /find/{filterId}/{ruleId}: получить информацию о фильтре по filter_id и rule_id
- /delete: удалить информацию о всех фильтрах
- /delete/{filterId}/{ruleId}: удалить информацию по конкретному фильтру filter_id и rule_id
- /save: создать фильтр
**/deduplication:**
- /findAll: получить информацию о всех правилах дедубликации в БД
- /findAll/{id}: получить информацию о всех правилах дедубликации в БД по deduplication_id
- /find/{filterId}/{ruleId}: получить информацию о правиле дедубликации по deduplication_id и rule_id
- /delete: удалить информацию о всех правилах дедубликации
- /delete/{filterId}/{ruleId}: удалить информацию по конкретному правилу дедубликации с deduplication_id и rule_id
- /save: создать правило дедубликации
**/enrichment:**
- /findAll: получить информацию о всех правилах обогащения в БД
- /findAll/{id}: получить информацию о всех правилах обогащения в БД по enrichment_id
- /find/{filterId}/{ruleId}: получить информацию о правиле обогащения по enrichment_id и rule_id
- /delete: удалить информацию о всех правилах обогащения
- /delete/{filterId}/{ruleId}: удалить информацию по конкретному правилу обогащения с enrichment_id и rule_id
- /save: создать правило обогащения
